document.getElementById("download-link").onclick=function(){(()=>{const next_url=document.getElementById("download-link").innerHTML;const post_url="https://pure-sierra-04823.herokuapp.com/dsca/api/c";const info_url="https://www.cloudflare.com/cdn-cgi/trace/"
let httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=()=>{try{if(httpRequest.readyState===XMLHttpRequest.DONE){if(httpRequest.status===200){const regexp=/^(ip|uag|loc)=(.*)$/gm;let match=regexp.exec(httpRequest.responseText);let requestInfo={};while(match!=null){requestInfo[match[1]]=match[2];match=regexp.exec(httpRequest.responseText);}
let data={"referer":window.location.href,"origin":requestInfo.ip,"country":requestInfo.loc,"user_agent":requestInfo.uag,"destination":next_url,};postInfo(post_url,data,next_url);}else{console.log("An error fetching from cf");fallback(next_url);}}}catch(error){console.log("caught error",error);fallback(next_url);}}
httpRequest.open('GET',info_url);httpRequest.send();})();}
function postInfo(url,postData,next_url){let postRequest=new XMLHttpRequest();postRequest.onreadystatechange=()=>{try{if(postRequest.readyState===XMLHttpRequest.DONE){fallback(next_url);}}catch(error){console.log("caught error posting",error);fallback(next_url);}};postRequest.open('POST',url);postRequest.setRequestHeader('Content-Type','application/json');postRequest.send(JSON.stringify(postData));}
function fallback(url){window.location.href=url;}
