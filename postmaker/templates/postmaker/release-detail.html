{% extends "layout.html" %}

{% load static %}

{% block title %}
{{ release }} | {{ block.super }}
{% endblock %}

{% block content %}
<div class="container mt-5 pt-5">
  <div class="card text-center">
    <div class="card-header">
      Release - Posted
      {% if release.posted %}
      ✅
      {% else %}
      ❌
      {% endif %}
    </div>
    <div class="card-body">
      <h3 class="card-title">{{ release }}</h3>
      <p class="card-text"></p>
      <div class="btn-arr d-flex flex-row justify-content-around">
        <a href="{% url 'postmaker:release_detail_make' release.pk %}" class="btn btn-primary">
          Go make a forum post
        </a>
        <div class="input-group" style="max-width: 250px;">
          {% csrf_token %}
          <input type="hidden" id="pk" name="pk" value="{{ release.pk }}">
          <input class="form-control" id="adamIDInput" type="text">
          <button type="button" class="btn btn-outline-secondary" id="adamIDPostBtn">Post As ID</button>
        </div>
      </div>
    </div>
    <div class="card-footer text-muted">
      {{ release.time|timesince }}
    </div>
  </div>
  <div>
    <a href="">

    </a>
  </div>
  <div class="form mt-5 pb-3">
    <form>
      {% for field in form %}
      <div class="field-error">
        {{ field.errors }}
      </div>
      <div class="input-group mb-3">
        <label class="input-group-text" for="{{ field.id_for_label }}">
          {{ field.label }}
        </label>

        {{ field }}
      </div>
      {% endfor %}
    </form>
  </div>
</div>
<script>
  document.getElementById("adamIDPostBtn").onclick = () => {
    let api_url = "/postmaker/api/post-with-id";
    let pk = document.getElementById("pk").value;
    let a_id = document.getElementById("adamIDInput").value;
    let token = document.querySelector('[name=csrfmiddlewaretoken]').value;
    let data = {
      'pk': pk,
      'a_id': a_id
    };

    fetch(api_url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': token
      },
      body: JSON.stringify(data)
    })
      .then(response => response.json())
      .then((content) => {
        if (content["error"]) {
          document.getElementsByClassName("card-header")[0].textContent = content["error"];
        } else {
          document.getElementsByClassName("card-header")[0].textContent = "Release - Posted ✅";
        }
      });
  }
</script>
{% endblock %}